---
title: 用Hexo和NexT构建博客
date: 2020-04-11 03:23:32
tags: [Hexo, NexT]
---

## 文档参考

+ [Hexo](https://hexo.io/docs/)
+ [NexT](https://theme-next.org/docs/)

## 安装 Hexo 和 NexT

+ 参考[Hexo Setup](https://hexo.io/docs/setup)
+ 参考[NexT Getting Started](https://theme-next.org/docs/getting-started/installation)

```bash
npm install hexo-cli -g
hexo init
git clone https://github.com/theme-next/hexo-theme-next themes/next
```

## 配置 Hexo

参考[Hexo Configuration](https://hexo.io/docs/configuration)

+ 修改项目根目录下的`_config.yml`文件
+ 网站信息主要修改 `title`, `subtitle`, `description`, `author`, `timezone`, `url`这几项，其余的稍后修改
+ `language: zh-CN`的支持是由NexT提供的，默认是没有效果的
+ `theme: next`其中`next`取决于你安装在`theme`下的目录名

## 配置 NexT

参考[NexT Configuration](https://theme-next.org/docs/getting-started/configuration)

1. 从`theme/next`目录下复制一份`_config.yml`到`source/data/next.yml`(具体路径取决于你的`_config.yml`)
2. 修改`next.yml`中需要的配置项: 美化相关参考[Theme Settings](https://theme-next.org/docs/theme-settings/), 第三方服务相关参考[Third Party Services](https://theme-next.org/docs/third-party-services/)

+ 个人建议启用第三方服务中的`Math Equations`支持以方便书写数学表达式

## 测试和部署

参考[NexT Deployment](https://theme-next.org/docs/getting-started/deployment)

### 本地测试

+ 构建前需要确保至少有一篇Post，否则可能会出现404的情况

```bash
hexo clean && hexo generate && hexo server --debug
```

### 手动部署

+ 在配置文件 `_config.yml` 的最后加入以下行

  ```yml
  deploy:
    type: git
    repo: # Git仓库路径
    branch: master
  ```

+ Git部署需要先安装对应的插件`npm install hexo-deployer-git`，然后和测试时类似

```bash
hexo clean && hexo generate && hexo deploy
```

### 持续集成

参考[Github Action Documentation](https://help.github.com/cn/actions)

+ 页面源代码会被公开
+ 本方法实现的持续集成实际上就是让代码托管帮我们执行上述 `手动部署` 的过程, 因此需要先配置手动部署的文件
+ 仓库下需要有两个 branch. 其中 `master` 分支是放生成后的静态页面, 另一个分支(`source`)放你的源码
+ 在 `source` 分支根目录下创建 `.github/workflows/nodejs.yml` 文件, 内容如下

  ```yml
  name: Node.js CI
  on:
    push:
      branches: [ source ]
  jobs:
    build:
      runs-on: ubuntu-latest
      strategy:
        matrix:
          node-version: [12.x]
      steps:
      - uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v1
        with:
          node-version: ${{ matrix.node-version }}
      - run: npm ci
      - name: Build and Deploy
        uses: renzhaosy/hexo-deploy-action@master
        env:
          PERSONAL_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PUBLISH_REPOSITORY: ${{ github.repository }}
          BRANCH: master
          PUBLISH_DIR: ./public
  ```

+ 然后把文件提交到Github仓库即可

## 使用博客

在上面进行配置的过程中应当已经学会简单使用Hexo了，下面算是一些总结的部分

### 新建Post

`hexo new <title>`或`hexo new post <title>`会创建文件于`source/_post/<title>.md`，其中最开始的内容应当类似如下

```yml
---
title: Hexo+NexT构建博客
date: 2020-04-11 03:23:32
tags: [Hexo, NexT]
---
```

此外，如果有相关配置的话，可以增加`categories`,`comments`等项以设置对应配置的属性

然后写下你要写的内容

### 提交Post

如果是手动部署就直接执行对应的命令行

如果是持续集成一般只要提交commit即可

+ 在提交之前可以先进行本地测试来预览一下

## 几个坑

+ 没有Post的时候访问根页面时404
+ 生成Post时出现

```bash
ERROR Render HTML failed: xxx/index.html
TypeError: Cannot read property 'replace' of null
```

参考<https://github.com/hexojs/hexo/issues/3859>

还有可能是在配置文件中把一些功能打开但是没用安装对应的依赖导致的(其他报错也可能是这个原因)

+ 持续集成时报错